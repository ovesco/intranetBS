<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>{% block titre %}{% endblock %}</title>
        <meta name="description" content="Outil de gestion de groupe scout développé par la Brigade de Sauvabelin">
        <meta name=viewport content="width=device-width, initial-scale=1">
        <meta name="mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="{{ asset('semantic/semantic.min.css') }}">
        <link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/jquery-editable/css/jquery-editable.css" rel="stylesheet"/>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:400,700,300&subset=latin,vietnamese' rel='stylesheet' type='text/css'>


        {% stylesheets
        '@AppBundle/Resources/public/css/Layout/*'
        '@AppBundle/Resources/public/css/Editable/*'
        '@AppBundle/Resources/public/css/bs.css'
        output='css/layout.css' %}
            <link rel="stylesheet" href="{{ asset_url }}" />
        {% endstylesheets %}

        {% block css %}{% endblock %}

        {# doit rester la pour que le bug report marche dans un maximum de cas#}
        <script src="{{ asset('assetic/jquery.js') }}"></script>


        {% block headjs %}{% endblock %}

    </head>

    <body>

        {{ render(controller('AppBundle:Layout:mainMenuGenerate')) }}

        <div class="pusher">

        {% include 'AppBundle:Layout:top_menu.html.twig' %}

        <div class="pushable">
            <div id="alerts-bag"></div>
            <div id="main-container">
                {% block content %}{% endblock %}
            </div>
            <div id="server-data" data-client="{% if clientData is defined %}{{ clientData }}{% endif %}"></div>
        </div>

        {#
            LISTING
            =======

            On définit le container, car il nous permettra ensuite de modifier le menu
            de manière dynamique à chaque fois qu'on souhaite accéder au listing
        #}
        <div class="ui top sidebar ui secondary segment" id="listing-bar"></div>

        {#
            On définit ici le container à menu. On y stocke le menu de popup géneré dynamiquement pour pouvoir
            l'afficher n'importe où sur la page
        #}
        <div id="popup-menu-container"></div>

        {% include 'AppBundle:Listing:modal_add_listing.html.twig' %}

        <!-- la modale d'ajout de distinctions -->
        {{ render(controller('AppBundle:Distinction:renderModalOrPersist')) }}

        <!-- la modale d'ajout d'attributions -->
        {{ render(controller('AppBundle:Attribution:renderModalOrPersist')) }}


        <!-- la modale pour terminer des attributions -->
        <div class="ui small modal" id="modal-terminer-attribution">
            <i class="close icon"></i>

            <div class="header">
                Terminer des attributions
            </div>

            <div class="content">
                <form method="post" action="{{ path('interne_attribution_terminer') }}">
                    <input type="hidden" name="ids" id="attributions-ids" />
                    <input type="text" name="dateFin" class="datepicker" />
                    <button type="submit" class="ui green button">Terminer <span id="amount-attributions-concerned"></span> attributions</button>
                </form>
            </div>

            <div class="actions">
                <div class="ui button">Annuler</div>
            </div>
        </div>


        <!-- on ajoute aussi un container qui contiendra les modales génerées dynamiquement -->
        <div id="dynamic-modal-container"></div>


        <script src="{{ asset('semantic/semantic.min.js') }}"></script>
        <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
        <script src="{{ path('fos_js_routing_js', {"callback": "fos.Router.setData"}) }}"></script>


        {% javascripts
            '@AppBundle/Resources/public/js/noty.js'
            '@AppBundle/Resources/public/js/noty_default.js'
            '@AppBundle/Resources/public/js/alwaysIncluded/*'
            '@AppBundle/Resources/public/js/layout.js'
            '@AppBundle/Resources/public/js/Contact/contact.js'
        output="js/main.js"
        %}
        <script src="{{ asset_url }}"></script>
        {% endjavascripts %}


        <script type="text/javascript">
            /*
             * Pour chaque flashbag contenu, sachant qu'ils ne contiennent que des alertes et des messages, on génère
             * une alerte correspondante.
             */
            $(document).ready(function(){
                {% for label, flashes in app.session.flashbag.all %}
                    {% for flash in flashes %}
                        alerte.send("{{ flash }}", "{{ label }}");
                    {% endfor %}
                {% endfor %}
            });
        </script>

        {% block js %}{% endblock %}

        </div>

    </body>
</html>